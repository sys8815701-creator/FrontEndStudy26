<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>반응형 카드 레이아웃</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.8/dist/css/bootstrap.min.css" rel="stylesheet">
    <style>
        .masonry-grid {
            position: relative;
        }

        .masonry-item {
            margin-bottom: 20px;
            transition: all 0.3s ease;
        }

        .card-img-top {
            width: 100%;
            height: auto;
            object-fit: cover;
        }

        .card:hover {
            transform: translateY(-5px);
            box-shadow: 0 8px 16px rgba(0,0,0,0.2);
        }

        /* 로딩 스켈레톤 */
        .skeleton {
            background: linear-gradient(90deg, #f0f0f0 25%, #e0e0e0 50%, #f0f0f0 75%);
            background-size: 200% 100%;
            animation: loading 1.5s infinite;
        }

        @keyframes loading {
            0% { background-position: 200% 0; }
            100% { background-position: -200% 0; }
        }
    </style>
</head>
<body>
    <div class="container my-5">
        <h2 class="mb-4">상품 갤러리</h2>

        <!-- 필터 버튼 -->
        <div class="btn-group mb-4" role="group">
            <button type="button" class="btn btn-outline-primary filter-btn active" data-filter="all">전체</button>
            <button type="button" class="btn btn-outline-primary filter-btn" data-filter="electronics">전자제품</button>
            <button type="button" class="btn btn-outline-primary filter-btn" data-filter="fashion">패션</button>
            <button type="button" class="btn btn-outline-primary filter-btn" data-filter="food">식품</button>
        </div>

        <!-- 카드 그리드 -->
        <div class="row masonry-grid" id="cardGrid">
            <!-- 카드들이 동적으로 추가됩니다 -->
        </div>

        <div class="text-center mt-4">
            <button class="btn btn-primary" id="loadMore">더 보기</button>
        </div>
    </div>

<script src="https://code.jquery.com/jquery-3.7.1.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.8/dist/js/bootstrap.bundle.min.js"></script>
<script>
$(document).ready(function() {
    // 샘플 데이터
    const products = [
        { id: 1, title: '무선 이어폰', category: 'electronics', price: 89000, image: 'https://via.placeholder.com/300x200', description: '고음질 블루투스 이어폰' },
        { id: 2, title: '면 티셔츠', category: 'fashion', price: 29000, image: 'https://via.placeholder.com/300x350', description: '편안한 일상복' },
        { id: 3, title: '유기농 커피', category: 'food', price: 15000, image: 'https://via.placeholder.com/300x250', description: '프리미엄 원두' },
        { id: 4, title: '스마트워치', category: 'electronics', price: 259000, image: 'https://via.placeholder.com/300x300', description: '건강 관리 기능 탑재' },
        { id: 5, title: '청바지', category: 'fashion', price: 79000, image: 'https://via.placeholder.com/300x400', description: '슬림핏 데님' },
        { id: 6, title: '초콜릿 세트', category: 'food', price: 35000, image: 'https://via.placeholder.com/300x220', description: '수제 프리미엄 초콜릿' },
        { id: 7, title: '노트북', category: 'electronics', price: 1290000, image: 'https://via.placeholder.com/300x280', description: '고성능 업무용 노트북' },
        { id: 8, title: '운동화', category: 'fashion', price: 129000, image: 'https://via.placeholder.com/300x320', description: '편안한 러닝화' }
    ];

    let currentPage = 0;
    let currentFilter = 'all';
    const itemsPerPage = 4;

    // 카드 HTML 생성
    function createCard(product) {
        return `
            <div class="col-lg-3 col-md-4 col-sm-6 masonry-item" data-category="${product.category}">
                <div class="card h-100">
                    <img src="${product.image}" class="card-img-top skeleton" alt="${product.title}">
                    <div class="card-body">
                        <h5 class="card-title">${product.title}</h5>
                        <p class="card-text text-muted">${product.description}</p>
                        <div class="d-flex justify-content-between align-items-center">
                            <span class="h5 mb-0 text-primary">${product.price.toLocaleString()}원</span>
                            <button class="btn btn-sm btn-outline-primary">장바구니</button>
                        </div>
                    </div>
                </div>
            </div>
        `;
    }

    // 카드 로드 및 표시
    function loadCards() {
        const filteredProducts = currentFilter === 'all'
            ? products
            : products.filter(p => p.category === currentFilter);

        const start = currentPage * itemsPerPage;
        const end = start + itemsPerPage;
        const pageProducts = filteredProducts.slice(start, end);

        if (pageProducts.length === 0) {
            $('#loadMore').hide();
            return;
        }

        pageProducts.forEach(product => {
            const $card = $(createCard(product));
            $('#cardGrid').append($card);

            // 이미지 로딩 완료 후 스켈레톤 제거
            $card.find('img').on('load', function() {
                $(this).removeClass('skeleton');
                applyMasonryLayout();
            });
        });

        currentPage++;

        // 더 이상 로드할 항목이 없으면 버튼 숨김
        if (end >= filteredProducts.length) {
            $('#loadMore').hide();
        }
    }

    // 매소리 레이아웃 적용
    function applyMasonryLayout() {
        const $grid = $('#cardGrid');
        const $items = $grid.find('.masonry-item:visible');

        // 화면 너비에 따른 컬럼 수 결정
        const width = $(window).width();
        let columns;
        if (width >= 992) columns = 4;      // lg
        else if (width >= 768) columns = 3; // md
        else if (width >= 576) columns = 2; // sm
        else columns = 1;                   // xs

        // 컬럼별 높이 배열 초기화
        const columnHeights = new Array(columns).fill(0);
        const columnWidth = $grid.width() / columns;

        $items.each(function(index) {
            const $item = $(this);

            // 가장 낮은 컬럼 찾기
            const minHeight = Math.min(...columnHeights);
            const columnIndex = columnHeights.indexOf(minHeight);

            // 카드 위치 계산
            const left = columnIndex * columnWidth;
            const top = minHeight;

            // 절대 위치 적용 (부드러운 애니메이션)
            $item.css({
                position: 'absolute',
                left: left + 'px',
                top: top + 'px',
                width: columnWidth + 'px'
            });

            // 해당 컬럼 높이 업데이트
            columnHeights[columnIndex] += $item.outerHeight(true);
        });

        // 그리드 전체 높이 설정
        const maxHeight = Math.max(...columnHeights);
        $grid.css('height', maxHeight + 'px');
    }

    // 필터링
    $('.filter-btn').on('click', function() {
        const filter = $(this).data('filter');

        // 버튼 활성화 상태 변경
        $('.filter-btn').removeClass('active');
        $(this).addClass('active');

        // 필터 적용
        currentFilter = filter;
        currentPage = 0;
        $('#cardGrid').empty();
        $('#loadMore').show();

        loadCards();
    });

    // 더 보기 버튼
    $('#loadMore').on('click', function() {
        loadCards();
    });

    // 윈도우 리사이즈 시 레이아웃 재계산
    let resizeTimer;
    $(window).on('resize', function() {
        clearTimeout(resizeTimer);
        resizeTimer = setTimeout(function() {
            applyMasonryLayout();
        }, 250);
    });

    // 초기 로드
    loadCards();
});
</script>
</body>
</html>
<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>할일 관리 앱</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.8/dist/css/bootstrap.min.css" rel="stylesheet">
    <style>
        .todo-item {
            cursor: move;
            transition: all 0.3s;
        }
        .todo-item:hover {
            background-color: #f8f9fa;
        }
        .todo-item.dragging {
            opacity: 0.5;
        }
        .todo-item.completed .todo-text {
            text-decoration: line-through;
            color: #6c757d;
        }
        .drag-over {
            border-top: 3px solid #0d6efd;
        }
    </style>
</head>
<body>
    <div class="container mt-5">
        <div class="row justify-content-center">
            <div class="col-md-8">
                <div class="card shadow">
                    <div class="card-header bg-primary text-white">
                        <h3 class="mb-0">할일 관리</h3>
                    </div>
                    <div class="card-body">
                        <!-- 입력 영역 -->
                        <div class="input-group mb-3">
                            <input type="text" id="todoInput" class="form-control"
                                   placeholder="새로운 할일을 입력하세요..."
                                   aria-label="할일 입력">
                            <button class="btn btn-primary" id="addBtn">추가</button>
                        </div>

                        <!-- 필터 버튼 -->
                        <div class="btn-group mb-3 w-100" role="group">
                            <button type="button" class="btn btn-outline-secondary active" data-filter="all">
                                전체
                            </button>
                            <button type="button" class="btn btn-outline-secondary" data-filter="active">
                                진행중
                            </button>
                            <button type="button" class="btn btn-outline-secondary" data-filter="completed">
                                완료
                            </button>
                        </div>

                        <!-- 할일 목록 -->
                        <div class="list-group" id="todoList">
                            <!-- 동적으로 생성됩니다 -->
                        </div>

                        <!-- 통계 정보 -->
                        <div class="mt-3 text-muted small">
                            <span>전체: <strong id="totalCount">0</strong></span> |
                            <span>진행중: <strong id="activeCount">0</strong></span> |
                            <span>완료: <strong id="completedCount">0</strong></span>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

<script src="https://code.jquery.com/jquery-3.7.1.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.8/dist/js/bootstrap.bundle.min.js"></script>
<script>
class TodoApp {
    constructor() {
        this.todos = this.loadFromStorage();
        this.currentFilter = 'all';
        this.draggedElement = null;
        this.init();
    }

    init() {
        this.render();
        this.bindEvents();
    }

    // 로컬 스토리지에서 불러오기
    loadFromStorage() {
        const data = localStorage.getItem('todos');
        return data ? JSON.parse(data) : [];
    }

    // 로컬 스토리지에 저장하기
    saveToStorage() {
        localStorage.setItem('todos', JSON.stringify(this.todos));
    }

    // 할일 추가
    addTodo(text) {
        if (!text.trim()) {
            alert('할일을 입력해주세요.');
            return;
        }

        const todo = {
            id: Date.now(),
            text: text.trim(),
            completed: false,
            createdAt: new Date().toISOString()
        };

        this.todos.push(todo);
        this.saveToStorage();
        this.render();
        $('#todoInput').val('');
    }

    // 할일 삭제
    deleteTodo(id) {
        this.todos = this.todos.filter(todo => todo.id !== id);
        this.saveToStorage();
        this.render();
    }

    // 완료 상태 토글
    toggleComplete(id) {
        const todo = this.todos.find(todo => todo.id === id);
        if (todo) {
            todo.completed = !todo.completed;
            this.saveToStorage();
            this.render();
        }
    }

    // 필터링된 할일 가져오기
    getFilteredTodos() {
        switch (this.currentFilter) {
            case 'active':
                return this.todos.filter(todo => !todo.completed);
            case 'completed':
                return this.todos.filter(todo => todo.completed);
            default:
                return this.todos;
        }
    }

    // 통계 업데이트
    updateStats() {
        const total = this.todos.length;
        const active = this.todos.filter(todo => !todo.completed).length;
        const completed = this.todos.filter(todo => todo.completed).length;

        $('#totalCount').text(total);
        $('#activeCount').text(active);
        $('#completedCount').text(completed);
    }

    // 화면 렌더링
    render() {
        const filteredTodos = this.getFilteredTodos();
        const $todoList = $('#todoList');
        $todoList.empty();

        if (filteredTodos.length === 0) {
            $todoList.append(`
                <div class="text-center text-muted py-5">
                    <p>할일이 없습니다.</p>
                </div>
            `);
        } else {
            filteredTodos.forEach(todo => {
                const $item = $(`
                    <div class="list-group-item todo-item ${todo.completed ? 'completed' : ''}"
                         data-id="${todo.id}" draggable="true">
                        <div class="d-flex align-items-center">
                            <input type="checkbox" class="form-check-input me-3 toggle-complete"
                                   ${todo.completed ? 'checked' : ''}>
                            <span class="todo-text flex-grow-1">${todo.text}</span>
                            <button class="btn btn-sm btn-danger delete-btn">삭제</button>
                        </div>
                    </div>
                `);
                $todoList.append($item);
            });
        }

        this.updateStats();
    }

    // 이벤트 바인딩
    bindEvents() {
        // 할일 추가
        $('#addBtn').on('click', () => {
            const text = $('#todoInput').val();
            this.addTodo(text);
        });

        $('#todoInput').on('keydown', (e) => {
            if (e.key === 'Enter') {
                const text = $('#todoInput').val();
                this.addTodo(text);
            }
        });

        // 필터 버튼
        $('[data-filter]').on('click', (e) => {
            const $btn = $(e.currentTarget);
            this.currentFilter = $btn.data('filter');
            $('[data-filter]').removeClass('active');
            $btn.addClass('active');
            this.render();
        });

        // 동적 이벤트 위임
        $('#todoList').on('change', '.toggle-complete', (e) => {
            const id = parseInt($(e.target).closest('.todo-item').data('id'));
            this.toggleComplete(id);
        });

        $('#todoList').on('click', '.delete-btn', (e) => {
            const id = parseInt($(e.target).closest('.todo-item').data('id'));
            if (confirm('정말 삭제하시겠습니까?')) {
                this.deleteTodo(id);
            }
        });

        // 드래그 앤 드롭 이벤트
        this.bindDragEvents();
    }

    // 드래그 앤 드롭 이벤트 바인딩
    bindDragEvents() {
        const $todoList = $('#todoList');

        $todoList.on('dragstart', '.todo-item', (e) => {
            this.draggedElement = e.currentTarget;
            $(e.currentTarget).addClass('dragging');
        });

        $todoList.on('dragend', '.todo-item', (e) => {
            $(e.currentTarget).removeClass('dragging');
            $('.drag-over').removeClass('drag-over');
        });

        $todoList.on('dragover', '.todo-item', (e) => {
            e.preventDefault();
            const $item = $(e.currentTarget);

            if (this.draggedElement !== e.currentTarget) {
                $item.addClass('drag-over');
            }
        });

        $todoList.on('dragleave', '.todo-item', (e) => {
            $(e.currentTarget).removeClass('drag-over');
        });

        $todoList.on('drop', '.todo-item', (e) => {
            e.preventDefault();
            const $target = $(e.currentTarget);
            $target.removeClass('drag-over');

            if (this.draggedElement !== e.currentTarget) {
                const draggedId = parseInt($(this.draggedElement).data('id'));
                const targetId = parseInt($target.data('id'));

                this.reorderTodos(draggedId, targetId);
            }
        });
    }

    // 할일 순서 변경
    reorderTodos(draggedId, targetId) {
        const draggedIndex = this.todos.findIndex(todo => todo.id === draggedId);
        const targetIndex = this.todos.findIndex(todo => todo.id === targetId);

        if (draggedIndex === -1 || targetIndex === -1) return;

        // 배열에서 요소 이동
        const [draggedTodo] = this.todos.splice(draggedIndex, 1);
        this.todos.splice(targetIndex, 0, draggedTodo);

        this.saveToStorage();
        this.render();
    }
}

// 앱 시작
$(document).ready(function() {
    const app = new TodoApp();
});
</script>
</body>
</html>